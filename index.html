<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Server Setup Guide</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    />
    <script src="/_sdk/element_sdk.js"></script>
    <style>
      body {
        box-sizing: border-box;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        line-height: 1.6;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #e2e8f0;
        overflow-x: hidden;
        scroll-behavior: smooth;
      }

      .toc {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 3rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .toc h2 {
        font-size: 1.5rem;
        margin-top: 0;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 1rem;
        color: #f093fb;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .toc ul {
        list-style: none;
        margin-left: 0;
        margin-bottom: 0;
        padding-left: 0;
      }

      .toc > ul > li {
        margin-bottom: 0.5rem;
      }

      .toc a {
        color: #cbd5e1;
        text-decoration: none;
        transition: all 0.2s ease;
        display: block;
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        font-size: 1rem;
        border: 1px solid transparent;
      }

      .toc > ul > li > a {
        font-weight: 600;
      }

      .toc a:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.05);
        transform: translateX(4px);
      }

      /* Nested items */
      .toc ul ul {
        margin-left: 0.75rem;
        margin-top: 0.25rem;
        padding-left: 1rem;
        border-left: 2px solid rgba(255, 255, 255, 0.1);
      }

      .toc ul ul li {
        margin-bottom: 0.25rem;
      }

      .toc ul ul a {
        font-size: 0.9rem;
        color: #94a3b8;
        padding: 0.35rem 0.75rem;
      }

      .toc ul ul a:hover {
        color: #e2e8f0;
        background: rgba(255, 255, 255, 0.05);
      }

      .wrapper {
        width: 100%;
        min-height: 100%;
        overflow-y: auto;
        padding: 3rem 1.5rem;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(30, 41, 59, 0.95);
        border-radius: 16px;
        padding: 3rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
      }

      h1 {
        font-size: 2.75rem;
        font-weight: 800;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.5px;
      }

      .subtitle {
        font-size: 1.125rem;
        color: #94a3b8;
        margin-bottom: 3rem;
        font-weight: 400;
      }

      h2 {
        font-size: 1.875rem;
        font-weight: 700;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        color: #f093fb;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(240, 147, 251, 0.2);
      }

      h3 {
        font-size: 1.375rem;
        font-weight: 600;
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #a78bfa;
      }

      p,
      li {
        color: #cbd5e1;
        margin-bottom: 0.75rem;
        font-size: 1rem;
      }

      ul {
        margin-left: 1.5rem;
        margin-bottom: 1.5rem;
      }

      li {
        margin-bottom: 0.5rem;
      }

      .code-block {
        margin: 1.5rem 0;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .code-header {
        background: #1e293b;
        padding: 0.75rem 1.25rem;
        border-bottom: 1px solid #334155;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .code-header::before {
        content: "";
        width: 12px;
        height: 12px;
        background: #ef4444;
        border-radius: 50%;
        box-shadow: 18px 0 0 #f59e0b, 36px 0 0 #10b981;
      }

      .code-label {
        font-size: 0.875rem;
        color: #64748b;
        font-family: "Monaco", "Courier New", monospace;
        margin-left: 2.5rem;
      }

      pre {
        margin: 0 !important;
        background: #0f172a !important;
        padding: 1.5rem !important;
        overflow-x: auto;
      }

      pre code {
        font-family: "Monaco", "Courier New", monospace;
        font-size: 0.9rem;
        line-height: 1.6;
      }

      .warning-box {
        background: rgba(251, 191, 36, 0.1);
        border-left: 4px solid #fbbf24;
        padding: 1.25rem;
        margin: 1.5rem 0;
        border-radius: 8px;
      }

      .warning-box p {
        color: #fde68a;
        margin: 0;
      }

      .info-box {
        background: rgba(59, 130, 246, 0.1);
        border-left: 4px solid #3b82f6;
        padding: 1.25rem;
        margin: 1.5rem 0;
        border-radius: 8px;
      }

      .info-box p {
        color: #93c5fd;
        margin: 0;
      }

      .step-number {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 32px;
        font-weight: 700;
        margin-right: 0.75rem;
        font-size: 0.875rem;
      }

      .optional {
        font-weight: 700;
        font-size: 0.875rem;
        padding-left: 1.5rem;
        padding-top: 1rem;
      }

      @media (max-width: 768px) {
        .container {
          padding: 2rem 1.5rem;
        }

        h1 {
          font-size: 2rem;
        }

        h2 {
          font-size: 1.5rem;
        }

        h3 {
          font-size: 1.25rem;
        }

        .wrapper {
          padding: 2rem 1rem;
        }

        .toc {
          padding: 1.5rem;
        }

        .back-to-top {
          bottom: 1rem;
          right: 1rem;
          width: 2.5rem;
          height: 2.5rem;
        }

        .code-header {
          padding: 0.5rem 1rem;
        }
      }

      .footer {
        text-align: center;
        padding: 2rem 0 0 0;
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.75rem;
        font-weight: 500;
        font-family: "Inter", sans-serif;
      }

      .copy-btn {
        margin-left: auto;
        background-color: #3b82f6;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        font-family: "Inter", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 32px;
        min-height: 32px;
      }

      .copy-btn:hover {
        background-color: #2563eb;
      }

      .copy-btn.success {
        background-color: #10b981;
      }

      .copy-btn.error {
        background-color: #ef4444;
      }

      .back-to-top {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .back-to-top.visible {
        opacity: 1;
        visibility: visible;
      }

      .back-to-top:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>

  <body>
    <div class="wrapper">
      <div class="container">
        <h1>Server Setup Guide</h1>
        <p class="subtitle">Setup Ubuntu servers for running Node.js, Angular and Docker</p>

        <nav class="toc">
          <h2>Table of Contents</h2>
          <ul>
            <li>
              <a href="#initial-system-setup">Initial System Setup</a>
              <ul>
                <li><a href="#update-and-upgrade-packages">Update and Upgrade Packages</a></li>
                <li><a href="#install-essential-tools">Install Essential Tools</a></li>
                <li>
                  <a href="#configure-automatic-security-updates"
                    >Configure Automatic Security Updates</a
                  >
                </li>
                <li><a href="#create-a-non-root-user">Create a Non-Root User</a></li>
              </ul>
            </li>
            <li>
              <a href="#set-up-ssh">Set Up SSH for Secure Remote Access</a>
              <ul>
                <li><a href="#install-ssh-server">Install and Enable SSH Server</a></li>
                <li><a href="#generate-ssh-keys">Generate SSH Keys on Your PC</a></li>
                <li><a href="#copy-public-key">Copy Public Key</a></li>
                <li><a href="#add-public-key">Add Public Key to Server</a></li>
                <li><a href="#harden-ssh-config">Harden SSH Configuration</a></li>
              </ul>
            </li>
            <li>
              <a href="#configure-fail2ban">Configure Fail2Ban</a>
              <ul>
                <li><a href="#start-fail2ban">Start and Enable Fail2Ban</a></li>
                <li><a href="#configure-jails">Configure Jails</a></li>
              </ul>
            </li>
            <li>
              <a href="#configure-firewall">Configure Firewall (UFW)</a>
              <ul>
                <li><a href="#install-ufw">Install UFW</a></li>
                <li><a href="#set-default-policies">Set Default Policies</a></li>
                <li><a href="#secure-ssh-access">Secure SSH Access</a></li>
                <li><a href="#allow-web-traffic">Allow Web Traffic</a></li>
                <li><a href="#enable-ufw">Enable UFW</a></li>
              </ul>
            </li>
            <li>
              <a href="#install-web-server">Install and Secure Web Server</a>
              <ul>
                <li><a href="#apache">Apache</a></li>
                <li><a href="#enable-https-apache">Enable HTTPS with Certbot</a></li>
                <li><a href="#security-headers">Security Headers</a></li>
                <li><a href="#nginx">Nginx</a></li>
                <li><a href="#enable-https-nginx">Enable HTTPS with Certbot</a></li>
              </ul>
            </li>
            <li>
              <a href="#install-mongodb">Install MongoDB</a>
              <ul>
                <li><a href="#change-mongodb-port">Change MongoDB Default Port</a></li>
                <li><a href="#create-admin-user">Create Admin User</a></li>
                <li><a href="#enable-authentication">Enable Authentication</a></li>
                <li><a href="#create-app-user">Create App-Specific User</a></li>
                <li><a href="#firewall-configuration">Firewall Configuration</a></li>
                <li><a href="#disable-http-interface">Disable MongoDB HTTP Interface</a></li>
                <li><a href="#enable-journaling">Enable Journaling (Data Safety)</a></li>
                <li><a href="#set-resource-limits">Set Resource Limits</a></li>
                <li>
                  <a href="#protect-against-brute-force">Protect Against Brute Force (Fail2Ban)</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="#install-nodejs">Install NodeJS</a>
              <ul>
                <li><a href="#nodejs-add-repo">Add NodeSource repo</a></li>
                <li><a href="#nodejs-install">Install</a></li>
                <li><a href="#nodejs-verify">Verify</a></li>
                <li><a href="#nodejs-install-pm2">Install PM2</a></li>
              </ul>
            </li>
            <li>
              <a href="#install-docker">Install Docker</a>
              <ul>
                <li><a href="#docker-add-repo">Add Docker repo</a></li>
                <li><a href="#docker-gpg-key">Add Docker GPG key</a></li>
                <li><a href="#docker-add-repository">Add Docker repository</a></li>
                <li><a href="#docker-install">Install Docker</a></li>
                <li><a href="#docker-start">Start Docker</a></li>
                <li><a href="#docker-verify">Verify Docker</a></li>
              </ul>
            </li>
            <li>
              <a href="#install-redis-docker">Install Redis on Docker</a>
              <ul>
                <li><a href="#redis-basic">Basic</a></li>
                <li><a href="#redis-persist-data">Persist data</a></li>
                <li><a href="#redis-memory-limit">Set max memory limit</a></li>
                <li><a href="#redis-auto-restart">Auto restart</a></li>
                <li><a href="#redis-verify">Verify</a></li>
              </ul>
            </li>
          </ul>
        </nav>
        <h2 id="initial-system-setup">Initial System Setup</h2>
        <h3 id="update-and-upgrade-packages">Update and Upgrade Packages</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">apt update &amp;&amp; apt upgrade -y &amp;&amp; apt autoremove -y</code></pre>
        </div>
        <h3 id="install-essential-tools">Install Essential Tools</h3>
        <p>Essential packages for server management and security:</p>
        <ul>
          <li><strong>sudo:</strong> For privilege escalation</li>
          <li><strong>curl/wget:</strong> For downloading scripts/files</li>
          <li><strong>net-tools:</strong> For netstat etc.</li>
          <li><strong>nano:</strong> Text editor</li>
          <li>
            <strong>fail2ban:</strong> Bans IPs after failed logins (e.g., SSH brute-force
            protection)
          </li>
          <li><strong>unattended-upgrades:</strong> For automatic security updates</li>
        </ul>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">apt install sudo curl wget net-tools nano fail2ban unattended-upgrades -y</code></pre>
        </div>
        <h3 id="configure-automatic-security-updates">Configure Automatic Security Updates</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">dpkg-reconfigure -plow unattended-upgrades</code></pre>
        </div>
        <h3 id="create-a-non-root-user">Create a Non-Root User</h3>
        <div class="warning-box">
          <p>Set a strong password (at least 24 characters, mixed case/symbols)</p>
        </div>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">adduser produser  # Set a strong password
usermod -aG sudo produser  # Add to sudo group</code></pre>
        </div>
        <p>Switch to this user:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">su - produser</code></pre>
        </div>
        <h2 id="set-up-ssh">Set Up SSH for Secure Remote Access</h2>
        <h3 id="install-ssh-server">Install and Enable SSH Server</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install openssh-server -y
sudo systemctl start ssh
sudo systemctl enable ssh</code></pre>
        </div>
        <h3 id="generate-ssh-keys">Generate SSH Keys on Your PC</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">ssh-keygen -t ed25519</code></pre>
        </div>
        <h3 id="copy-public-key">Copy Public Key</h3>
        <p><strong>Windows:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">powershell</span></div>
          <pre><code class="language-powershell">Get-Content $HOME\.ssh\id_ed25519.pub</code></pre>
        </div>
        <p><strong>Linux:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">cat ~/.ssh/id_ed25519.pub</code></pre>
        </div>
        <h3 id="add-public-key">Add Public Key to Server</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">mkdir -p ~/.ssh 
chmod 700 ~/.ssh
nano ~/.ssh/authorized_keys</code></pre>
        </div>
        <h3 id="harden-ssh-config">Harden SSH Configuration</h3>
        <p>Edit SSH config:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/ssh/sshd_config</code></pre>
        </div>
        <p>Set these parameters:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">config</span></div>
          <pre><code class="language-bash">PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes</code></pre>
        </div>
        <p>Restart SSH:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart ssh</code></pre>
        </div>
        <h2 id="configure-fail2ban">Configure Fail2Ban</h2>
        <h3 id="start-fail2ban">Start and Enable Fail2Ban</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl start fail2ban
sudo systemctl enable fail2ban</code></pre>
        </div>
        <h3 id="configure-jails">Configure Jails</h3>
        <p>Edit jail configuration:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/fail2ban/jail.local</code></pre>
        </div>
        <p>Add this configuration:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">config</span></div>
          <pre><code class="language-ini">[DEFAULT]
bantime  = 1h
findtime = 10m
maxretry = 50
backend  = systemd
banaction = ufw

[sshd]
enabled = true
port    = ssh
logpath = %(sshd_log)s</code></pre>
        </div>
        <p>Restart Fail2Ban:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart fail2ban</code></pre>
        </div>
        <p>Verify jails:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo fail2ban-client status</code></pre>
        </div>
        <h2 id="configure-firewall">Configure Firewall (UFW)</h2>
        <h3 id="install-ufw">Install UFW</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install ufw -y</code></pre>
        </div>
        <h3 id="set-default-policies">Set Default Policies</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw default deny incoming
sudo ufw default allow outgoing</code></pre>
        </div>
        <h3 id="secure-ssh-access">Secure SSH Access</h3>
        <p><strong>Option 1:</strong> Allow from specific IP:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw allow from &lt;YOUR_PUBLIC_IP&gt; to any port 22 proto tcp</code></pre>
        </div>
        <p><strong>Option 2:</strong> Rate-limit SSH:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw limit ssh</code></pre>
        </div>
        <h3 id="allow-web-traffic">Allow Web Traffic</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw allow 80/tcp
sudo ufw allow 443/tcp</code></pre>
        </div>
        <h3 id="enable-ufw">Enable UFW</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw enable
sudo ufw status verbose</code></pre>
        </div>
        <h2 id="install-web-server">Install and Secure Web Server</h2>
        <h3 id="apache">Apache</h3>
        <p><strong>Install Apache:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install apache2 -y</code></pre>
        </div>
        <p><strong>Start and Enable:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl start apache2
sudo systemctl enable apache2</code></pre>
        </div>
        <p><strong>Harden Apache Config:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/apache2.conf</code></pre>
        </div>
        <div class="info-box">
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">ServerTokens Prod
ServerSignature Off

&lt;Directory /var/www/>
    Options -Indexes
    AllowOverride None
    Require all granted
&lt;/Directory></code></pre>
          </div>
        </div>
        <p><strong>Install ModSecurity:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install libapache2-mod-security2 -y
sudo a2enmod security2
sudo systemctl restart apache2</code></pre>
        </div>
        <p><strong>Enable ModSecurity:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/modsecurity/modsecurity.conf</code></pre>
        </div>
        <div class="info-box">
          <p>Set <code class="language-bash">SecRuleEngine On</code></p>
        </div>
        <p><strong>Install OWASP Core Rule Set:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install modsecurity-crs -y</code></pre>
        </div>
        <p><strong>Enable OWASP CRS:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo cp /usr/share/modsecurity-crs/crs-setup.conf.example \
/etc/modsecurity/crs-setup.conf</code></pre>
          <p class="optional"><strong>OR</strong></p>
          <pre><code class="language-bash">sudo cp /usr/share/modsecurity-crs/crs-setup.conf.example \
/etc/modsecurity/crs-setup.conf
</code></pre>
        </div>
        <p><strong>Configure ModSecurity in Apache:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/mods-enabled/security2.conf</code></pre>
        </div>
        <p>Ensure it contains:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">config</span></div>
          <pre><code class="language-apache">IncludeOptional /etc/modsecurity/*.conf
IncludeOptional /etc/modsecurity/crs-setup.conf
IncludeOptional /usr/share/modsecurity-crs/rules/*.conf</code></pre>
        </div>
        <p><strong>Test and Restart:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">apachectl configtest
sudo systemctl restart apache2</code></pre>
        </div>
        <p><strong>Angular SPA:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/sites-available/app1.conf</code></pre>
        </div>
        <div class="info-box">
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">&lt;VirtualHost *:80>
    ServerName app1.example.com
    DocumentRoot /var/www/angular-app1

    &lt;Directory /var/www/angular-app1>
        AllowOverride All
        Require all granted
    &lt;/Directory>

    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.html [L]
&lt;/VirtualHost></code></pre>
          </div>
        </div>
        <p>enable:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo a2ensite app1</code></pre>
        </div>
        <p><strong>Node.js API (Reverse Proxy):</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/sites-available/api1.conf</code></pre>
        </div>
        <div class="info-box">
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">&lt;VirtualHost *:80>
    ServerName api1.example.com

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/

    RequestHeader set X-Forwarded-Proto "http"
&lt;/VirtualHost></code></pre>
          </div>
        </div>
        <p>enable:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo a2ensite api1
sudo systemctl reload apache2</code></pre>
        </div>
        <h3 id="enable-https-apache">Enable HTTPS with Certbot</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install certbot python3-certbot-apache -y
sudo certbot --apache
sudo certbot renew --dry-run</code></pre>
        </div>
        <p>Restart Apache:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart apache2</code></pre>
        </div>
        <h3 id="security-headers">Security Headers</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/apache2/conf-available/security-headers.conf</code></pre>
        </div>
        <div class="info-box">
          <div class="code-block">
            <div class="code-header"><span class="code-label">apache</span></div>
            <pre><code class="language-apache">Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "DENY"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"</code></pre>
          </div>
        </div>
        <p>enable:</p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo a2enconf security-headers
sudo systemctl reload apache2</code></pre>
        </div>
        <h3 id="nginx">Nginx</h3>
        <p><strong>Install Nginx:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install nginx -y</code></pre>
        </div>
        <p><strong>Start and Enable:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl start nginx
sudo systemctl enable nginx</code></pre>
        </div>
        <p><strong>Harden Nginx Config:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/nginx/nginx.conf</code></pre>
        </div>
        <div class="info-box">
          <p>Set these inside the http {} block.</p>
          <div class="code-block">
            <div class="code-header"><span class="code-label">nginx</span></div>
            <pre><code class="language-nginx">server_tokens off;

# Performance & DoS protection
sendfile on;
tcp_nopush on;
tcp_nodelay on;
keepalive_timeout 65;
types_hash_max_size 2048;

# Prevent large request abuse
client_body_timeout 10s;
client_header_timeout 10s;
send_timeout 10s;

# Rate-limit zone for APIs
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;</code></pre>
          </div>
        </div>
        <p><strong>Configure site (reverse proxy + headers):</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/nginx/sites-available/default</code></pre>
        </div>
        <p><strong>Edit default site:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">nginx</span></div>
          <pre><code class="language-nginx">server {
    listen 80;
    server_name example.com;

    # --------------------
    # Global security
    # --------------------
    server_tokens off;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Disable directory listing everywhere by default
    autoindex off;

    
    # --------------------
    # Static website
    # --------------------
    location / {
        root /var/www/site;
        index index.html;
        try_files $uri $uri/ =404;
    }

    # --------------------
    # Node.js API (secured)
    # --------------------
    location /api/ {
        # Rate limit API
        # limit_req zone=api_limit burst=20 nodelay;

        # Block common bad methods
        limit_except GET POST PUT DELETE {
            deny all;
        }

        # Proxy settings
        proxy_pass http://127.0.0.1:3000/;
        proxy_http_version 1.1;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Timeouts (prevent slowloris)
        proxy_connect_timeout 5s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    # --------------------
    # File downloads (locked down)
    # --------------------
    location /files/ {
        alias /srv/files/;

        # Only allow GET
        limit_except GET {
            deny all;
        }

        # Prevent execution
        types {
            text/plain txt;
            application/pdf pdf;
        }

        default_type application/octet-stream;
    }

    # --------------------
    # Block hidden files
    # --------------------
    location ~ /\.(?!well-known) {
        deny all;
    }

    # --------------------
    # Size limits
    # --------------------
    client_max_body_size 10M;
}
</code></pre>
        </div>
        <p><strong>Restart Nginx:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl reload nginx</code></pre>
        </div>
        <h3 id="enable-https-nginx">Enable HTTPS with Certbot</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx
sudo certbot renew --dry-run
</code></pre>
        </div>
        <p><strong>Restart Nginx:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl reload nginx</code></pre>
        </div>
        <h2 id="install-mongodb">Install MongoDB</h2>
        <p><strong>Import MongoDB GPG key:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">curl -fsSL https://pgp.mongodb.com/server-7.0.asc | \
sudo gpg --dearmor -o /usr/share/keyrings/mongodb-server.gpg</code></pre>
        </div>
        <p><strong>Add MongoDB repository:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">echo "deb [signed-by=/usr/share/keyrings/mongodb-server.gpg] \
https://repo.mongodb.org/apt/ubuntu $(lsb_release -cs)/mongodb-org/7.0 multiverse" | \
sudo tee /etc/apt/sources.list.d/mongodb-org.list</code></pre>
        </div>
        <p><strong>Install MongoDB:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt update
sudo apt install -y mongodb-org</code></pre>
        </div>
        <p><strong>Start and enable MongoDB:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl start mongod
sudo systemctl enable mongod</code></pre>
        </div>
        <h3 id="change-mongodb-port">Change MongoDB Default Port</h3>
        <p><strong>Edit MongoDB config:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/mongod.conf</code></pre>
        </div>
        <p><strong>Change port and bind IP:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">yaml</span></div>
          <pre><code class="language-yaml">net:
  port: 42058
  bindIp: 127.0.0.1</code></pre>
        </div>
        <p><strong>Restart MongoDB:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart mongod</code></pre>
        </div>
        <p><strong>Verify:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">ss -tulnp | grep mongod</code></pre>
        </div>
        <h3 id="create-admin-user">Create Admin User</h3>
        <p><strong>Connect locally:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">mongosh --port 42058</code></pre>
        </div>
        <p><strong>Create admin user:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">js</span></div>
          <pre><code class="language-js">use admin
db.createUser({
  user: "adminUser",
  pwd: "STRONG_PASSWORD_HERE",
  roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
})</code></pre>
        </div>
        <h3 id="enable-authentication">Enable Authentication</h3>
        <p><strong>Edit config:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/mongod.conf</code></pre>
        </div>
        <p><strong>Enable auth:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">yaml</span></div>
          <pre><code class="language-yaml">security:
  authorization: enabled</code></pre>
        </div>
        <p><strong>Restart MongoDB:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart mongod</code></pre>
        </div>
        <p><strong>Test login:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">mongosh --port 42058 -u adminUser -p --authenticationDatabase admin</code></pre>
        </div>
        <h3 id="create-app-user">Create App-Specific User</h3>
        <p><strong>Create app user:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">js</span></div>
          <pre><code class="language-js">use myappdb
db.createUser({
  user: "appUser",
  pwd: "STRONG_PASSWORD_HERE",
  roles: [
    { role: "readWrite", db: "myappdb" }
  ]
})</code></pre>
        </div>
        <h3 id="firewall-configuration">Firewall Configuration</h3>
        <p><strong>If MongoDB is local only:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw deny 42058</code></pre>
        </div>
        <p><strong>If accessed from another server (private IP only):</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw allow from 10.0.0.5 to any port 42058</code></pre>
        </div>
        <p><strong>Check:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo ufw status verbose</code></pre>
        </div>
        <h3 id="disable-http-interface">Disable MongoDB HTTP Interface</h3>
        <p><strong>Ensure this is not enabled:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">yaml</span></div>
          <pre><code class="language-bash"># DO NOT enable this
# net:
#   http:
#     enabled: true</code></pre>
        </div>
        <h3 id="enable-journaling">Enable Journaling (Data Safety)</h3>
        <p><strong>Ensure this exists:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">yaml</span></div>
          <pre><code class="language-bash">storage:
  journal:
    enabled: true</code></pre>
        </div>
        <h3 id="set-resource-limits">Set Resource Limits</h3>
        <p><strong>MongoDB system limits:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/security/limits.conf</code></pre>
        </div>
        <div class="info-box">
          <p>
            Add <code class="language-bash">mongod soft nofile 64000</code>
            <code class="language-bash">mongod hard nofile 64000</code>
          </p>
        </div>
        <p><strong>Restart MongoDB:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart mongod</code></pre>
        </div>
        <h3 id="protect-against-brute-force">Protect Against Brute Force (Fail2Ban)</h3>
        <p><strong>Open mongodb config:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/fail2ban/filter.d/mongodb.conf</code></pre>
        </div>
        <p><strong>Create filter:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">[Definition]
failregex = .*authentication failed.*client: &lt;HOST&gt;.* </code></pre>
        </div>
        <p><strong>Create jail:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo nano /etc/fail2ban/jail.local</code></pre>
          <hr />
          <pre><code class="language-bash">[mongodb]
enabled = true
port = 27018
filter = mongodb
logpath = /var/log/mongodb/mongod.log
maxretry = 15</code></pre>
        </div>
        <p><strong>Restart:</strong></p>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl restart fail2ban</code></pre>
        </div>

        <h2 id="install-nodejs">Install NodeJS</h2>
        <h3 id="nodejs-add-repo">Add NodeSource repo</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -</code></pre>
        </div>
        <h3 id="nodejs-install">Install</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt install nodejs -y

</code></pre>
        </div>
        <h3 id="nodejs-verify">Verify</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">node --version
npm --version</code></pre>
        </div>
        <h3 id="nodejs-install-pm2">Install PM2</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo npm install -g pm2
pm2 startup</code></pre>
        </div>

        <h2 id="install-docker">Install Docker</h2>
        <h3 id="docker-add-repo">Add Docker repo</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt update
sudo apt upgrade -y
sudo apt install -y apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release
</code></pre>
        </div>
        <h3 id="docker-gpg-key">Add Docker GPG key</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</code></pre>
        </div>
        <h3 id="docker-add-repository">Add Docker repository</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
</code></pre>
        </div>
        <h3 id="docker-install">Install Docker</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-buildx-plugin 
</code></pre>
        </div>
        <h3 id="docker-start">Start Docker</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl start docker
sudo systemctl enable docker</code></pre>
        </div>
        <h3 id="docker-verify">Verify Docker</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">sudo systemctl status docker
sudo docker --version
sudo docker compose --version</code></pre>
        </div>

        <h2 id="install-redis-docker">Install Redis on Docker</h2>
        <h3 id="redis-basic">Basic</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">docker run -d \
  -p 127.0.0.1:7512:7512 \
  --name redis \
  --memory 512m \
  --memory-swap 512m \
  redis:latest \
  --requirepass YOUR_PASSWORD \
  --protected-mode yes</code></pre>
        </div>
        <h3 id="redis-persist-data">Persist data</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">docker run -d \
  -p 127.0.0.1:7512:7512 \
  --name redis \
  --memory 512m \
  -v /srv/redis/data:/data \
  redis:latest \
  redis-server --requirepass YOUR_PASSWORD --protected-mode yes --appendonly yes</code></pre>
        </div>
        <h3 id="redis-memory-limit">Set max memory limit</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">docker exec -it redis redis-cli -a YOUR_PASSWORD</code></pre>
        </div>
        <div class="info-box">
          <p>
            <strong>
              <ul>
                <li>maxmemory < Docker memory limit</li>
                <li>allkeys-lru â†’ Redis evicts least-recently-used keys when memory fills</li>
                <li>Prevents Redis from crashing when full</li>
              </ul>
            </strong>
          </p>
          <div class="code-block">
            <div class="code-header"><span class="code-label">bash</span></div>
            <pre><code class="language-bash">CONFIG SET maxmemory 400mb
CONFIG SET maxmemory-policy allkeys-lru</code></pre>
          </div>
        </div>
        <h3 id="redis-auto-restart">Auto restart</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">docker run -d \
  -p 127.0.0.1:7512:7512 \
  --name redis \
  --memory 512m \
  --restart unless-stopped \
  -v /srv/redis/data:/data \
  redis:latest \
  redis-server --requirepass YOUR_PASSWORD --protected-mode yes --appendonly yes</code></pre>
        </div>
        <h3 id="redis-verify">Verify</h3>
        <div class="code-block">
          <div class="code-header"><span class="code-label">bash</span></div>
          <pre><code class="language-bash">docker ps</code></pre>
        </div>
      </div>
      <footer class="footer">
        <div>Made with ðŸ’™ by Shamal Rathnayake</div>
        <div>Spera@2026</div>
      </footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-powershell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ini.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-apache.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-nginx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script>
      const defaultConfig = {
        background_color: "#667eea",
        surface_color: "#1e293b",
        text_color: "#e2e8f0",
        primary_action_color: "#f093fb",
        secondary_action_color: "#a78bfa",
        font_family: "Inter",
        font_size: 16,
        guide_title: "Server Setup Guide",
        guide_subtitle: "Setup Ubuntu servers for running Node.js, Angular and Docker",
      };

      async function onConfigChange(config) {
        const customFont = config.font_family || defaultConfig.font_family;
        const baseSize = config.font_size || defaultConfig.font_size;
        const baseFontStack = "system-ui, -apple-system, sans-serif";

        document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
        document.body.style.background = `linear-gradient(135deg, ${
          config.background_color || defaultConfig.background_color
        } 0%, #764ba2 100%)`;

        const container = document.querySelector(".container");
        if (container) {
          container.style.background = `${config.surface_color || defaultConfig.surface_color}ee`;
        }

        document.body.style.fontSize = `${baseSize}px`;

        const h1 = document.querySelector("h1");
        if (h1) {
          h1.style.fontSize = `${baseSize * 2.75}px`;
          h1.textContent = config.guide_title || defaultConfig.guide_title;
        }

        const subtitle = document.querySelector(".subtitle");
        if (subtitle) {
          subtitle.style.fontSize = `${baseSize * 1.125}px`;
          subtitle.textContent = config.guide_subtitle || defaultConfig.guide_subtitle;
        }

        document.querySelectorAll("h2").forEach((h2) => {
          h2.style.fontSize = `${baseSize * 1.875}px`;
          h2.style.color = config.primary_action_color || defaultConfig.primary_action_color;
          h2.style.borderBottomColor = `${
            config.primary_action_color || defaultConfig.primary_action_color
          }33`;
        });

        document.querySelectorAll("h3").forEach((h3) => {
          h3.style.fontSize = `${baseSize * 1.375}px`;
          h3.style.color = config.secondary_action_color || defaultConfig.secondary_action_color;
        });

        document.querySelectorAll("p, li").forEach((el) => {
          el.style.fontSize = `${baseSize}px`;
          el.style.color = config.text_color || defaultConfig.text_color;
        });
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                },
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                },
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                },
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                },
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                },
              },
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              },
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              },
            },
          }),
          mapToEditPanelValues: (config) =>
            new Map([
              ["guide_title", config.guide_title || defaultConfig.guide_title],
              ["guide_subtitle", config.guide_subtitle || defaultConfig.guide_subtitle],
            ]),
        });
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const codeBlocks = document.querySelectorAll(".code-block");

        codeBlocks.forEach((block) => {
          const header = block.querySelector(".code-header");
          const code = block.querySelector("code");

          if (header && code) {
            const button = document.createElement("button");
            button.className = "copy-btn";
            const copyIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
            button.innerHTML = copyIcon;
            button.type = "button";
            button.ariaLabel = "Copy code";

            button.addEventListener("click", async () => {
              try {
                await navigator.clipboard.writeText(code.innerText);

                // Success feedback
                button.textContent = "Copied!";
                button.classList.add("success");
                button.style.padding = "0.25rem 0.75rem"; // Adjust padding for text

                setTimeout(() => {
                  button.innerHTML = copyIcon;
                  button.classList.remove("success");
                  button.style.padding = "0.5rem"; // Revert padding for icon
                }, 2000);
              } catch (err) {
                console.error("Failed to copy:", err);

                // Error feedback
                button.textContent = "Error";
                button.classList.add("error");
                button.style.padding = "0.25rem 0.75rem";

                setTimeout(() => {
                  button.innerHTML = copyIcon;
                  button.classList.remove("error");
                  button.style.padding = "0.5rem";
                }, 2000);
              }
            });

            header.appendChild(button);
          }
        });

        // Back to Top Button Logic
        const backToTopBtn = document.getElementById("back-to-top");
        if (backToTopBtn) {
          window.addEventListener("scroll", () => {
            if (window.scrollY > 300) {
              backToTopBtn.classList.add("visible");
            } else {
              backToTopBtn.classList.remove("visible");
            }
          });

          backToTopBtn.addEventListener("click", () => {
            window.scrollTo({ top: 0, behavior: "smooth" });
          });
        }
      });
    </script>
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 15l-6-6-6 6" />
      </svg>
    </button>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9b984cec12635134',t:'MTc2NzY3MTk0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener) document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState && ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
